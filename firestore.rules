rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ===================================
    // REGRAS PARA INICIALIZAÇÃO AUTOMÁTICA
    // Permite criar documentos se não existem (para inicializador)
    // ===================================

    // Content: leitura pública, escrita autenticada
    match /content/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // Pacotes: leitura pública, escrita autenticada
    match /pacotes/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // Avaliações: leitura e criação pública, atualização/exclusão autenticada
    match /avaliacoes/{documentId} {
      allow read: if true;
      allow create: if true; // permite criação pública e inicialização
      allow update, delete: if request.auth != null;
    }

    // Reservas: criação pública (formulário de reservas), leitura/edição apenas admin
    match /reservas/{documentId} {
      allow read: if request.auth != null; // Apenas admin pode ler reservas
      allow create: if true; // Público pode criar reservas via formulário
      allow update, delete: if request.auth != null; // Apenas admin gerencia
    }
    
    // Listas (passeios, veículos, hotéis, aeroportos): leitura pública, escrita autenticada
    match /listas/{documentId} {
      allow read: if true; // Público lê para preencher dropdowns dos formulários
      allow write: if true; // Permite inicialização automática (depois restringir a admin apenas)
    }

    // Usuários: leitura e escrita apenas para o próprio usuário
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      allow create: if true; // permite criação inicial de usuários demo
    }

    // Motoristas: leitura autenticada, criação permitida para inicialização
    match /motoristas/{documentId} {
      allow read: if request.auth != null;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // Settings: leitura pública, escrita autenticada
    match /settings/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // Viagens: leitura pública, escrita autenticada
    match /viagens/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // Produtos: leitura pública, escrita autenticada
    match /produtos/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // Banners Lojinha: leitura pública, escrita autenticada
    match /bannersLojinha/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // Banners Turismo: leitura pública, escrita autenticada
    match /bannersTurismo/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // Banners: leitura pública, escrita autenticada (compatibilidade)
    match /banners/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // Blog Posts: leitura pública, escrita autenticada
    match /blogPosts/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // Images: leitura pública, escrita autenticada
    match /images/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // WhatsApp Config: leitura pública, escrita autenticada
    match /whatsappConfig/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização
      allow update, delete: if request.auth != null;
    }

    // Analytics: leitura pública, escrita autenticada
    match /analytics/{documentId} {
      allow read: if true;
      allow create: if true; // permite registro de views
      allow update, delete: if request.auth != null;
    }

    // Regra catch-all: permite leitura pública e criação para qualquer coleção nova
    // (facilita inicialização, mas pode ser restringida depois)
    match /{collection}/{documentId} {
      allow read: if true;
      allow create: if true; // permite inicialização de qualquer coleção
      allow update, delete: if request.auth != null;
    }
  }
}

service firebase.storage {
  match /b/{bucket}/o {
    // Logos: leitura pública, escrita autenticada
    match /logos/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Imagens de pacotes: leitura pública, escrita autenticada
    match /pacotes/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Imagens de produtos: leitura pública, escrita autenticada
    match /produtos/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Banners: leitura pública, escrita autenticada
    match /banners/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Avatares de usuários: leitura pública, escrita autenticada
    match /avatars/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Regra geral: leitura pública, escrita autenticada
    match /{allPaths=**} {
      allow read: if true; // permite leitura de qualquer arquivo público
      allow write: if request.auth != null; // escrita só para autenticados
    }
  }
}